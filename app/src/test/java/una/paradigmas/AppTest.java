package una.paradigmas;

import org.junit.Test;

import una.paradigmas.ast.AstBuilder;
import una.paradigmas.ast.AstPrintVisitor;
import una.paradigmas.ast.ExpressoLexer;
import una.paradigmas.ast.ExpressoParser;
import una.paradigmas.ast.JavaCodeGenerator;
import una.paradigmas.ast.Program;


import org.antlr.v4.runtime.CharStream;
import org.antlr.v4.runtime.CharStreams;
import org.antlr.v4.runtime.CommonTokenStream;

 /**
 * Proyecto: Expresso - Transpilador de lenguaje Expresso a Java
 * Curso: [EIF400-II-2025] Paradigmas de Programacion
 * Universidad Nacional de Costa Rica
 * 
 * Autores:
 * - Kendall Miso Chinchilla Araya  -   119310542
 * - Ignacio Serrano Gonzalez       -   402600631
 * - Minor Brenes Aguilar           -   116730106
 * - Pablo Chavarria Alvarez        -   117810573
 * 
 * Codigo de grupo: 02-1PM
 * 
 * This source file was generated by the Gradle 'init' task
 * 
 * Nota: Este codigo fue generado parcialmente con asistencia de IA
 * y posteriormente modificado, adaptado y validado por el equipo
 * de desarrollo para cumplir con los requerimientos especificos
 * del proyecto.
 */

 public class AppTest {
    
    private void testExpressoProgram(String input, String className) {
        CharStream charStream = CharStreams.fromString(input);
        ExpressoLexer lexer = new ExpressoLexer(charStream);
        CommonTokenStream tokens = new CommonTokenStream(lexer);
        ExpressoParser parser = new ExpressoParser(tokens);

        //parsear y construir AST
        AstBuilder builder = new AstBuilder();
        Program ast = builder.visitProgram(parser.program());

        // imprimir con print visitor
        AstPrintVisitor printer = new AstPrintVisitor();
        // printer.visitProgram(ast);

        // Generar codigo Java a partir del AST
        JavaCodeGenerator generator = new JavaCodeGenerator(className);
        String javaCode = generator.generate(ast);
        System.out.println("\n");
        System.out.println(javaCode);
    }

    @Test 
    public void testHelloWorld0() {

        System.out.println("====== Test HelloWorld0.expresso ======");
                      
        String input = "// HelloWorld0.expresso\n" +
                      "let x = 666\n" +
                      "print(x) // Expected 666 in console\n" +
                      "let y = 10\n" +
                      "print(y) // Expected 10 in console\n" +
                      "let f = z -> z ** 2 + 2*z + 1\n" +
                      "print(f(x) + f(y)) // expected 445010\n";
        
        testExpressoProgram(input, "HelloWorld0");
    }

    @Test 
    public void testHelloWorld1() {

        System.out.println("====== Test HelloWorld1.expresso ======");

        String input = "// HelloWorld1.expresso\n\n" +
                      "/*\n" +
                      "  As HelloWorld0 but with a Binary Function\n" +
                      "  @author hooNous\n" +
                      "  @since Oct 6th, 2025\n" +
                      "*/\n\n" +
                      "let x = 6\n" +
                      "print(x)\n" +
                      "let y = 3\n" +
                      "print(y)\n" +
                      "let f = (x, z) -> z ** x + x*z + 1\n" +
                      "print(f(x, y)) // Expected 748\n";
        
        testExpressoProgram(input, "HelloWorld1");
    }

    @Test 
    public void testHelloWorld2() {

        System.out.println("====== Test HelloWorld2.expresso ======");

        String input = "// HelloWorld2.expresso\n\n" +
                      "/*\n" +
                      "  Boolean Logic\n" +
                      "  @author hooNous\n" +
                      "  @since Oct 6th, 2025\n" +
                      "*/\n\n" +
                      "let isZero = x -> x ? 0 : 1\n" +
                      "let TRUE  = 1\n" +
                      "let FALSE = 0\n\n" +
                      "let isTrue = x -> isZero(x) ? FALSE : TRUE\n\n" +
                      "let NOT = x -> x ? 0 : 1\n\n" +
                      "let OR =  (x, y) -> isTrue(x) ? TRUE : isTrue(y)\n\n" +
                      "let AND = (x, y) -> isTrue(x) ? isTrue(y) : FALSE\n\n" +
                      "let XOR = (x, y) -> AND(OR(x, y), NOT(AND(x, y)))\n\n" +
                      "print(XOR(TRUE, TRUE))   // Expected 0\n" +
                      "print(XOR(TRUE, FALSE))  // Expected 1\n" +
                      "print(XOR(FALSE, TRUE))  // Expected 1\n" +
                      "print(XOR(FALSE, FALSE)) // Expected 0\n";
        
        testExpressoProgram(input, "HelloWorld2");
    }
}