package una.paradigmas;

import org.junit.Test;

import una.paradigmas.ast.AstBuilder;
// import una.paradigmas.ast.AstPrintVisitor;
import una.paradigmas.ast.ExpressoLexer;
import una.paradigmas.ast.ExpressoParser;
import una.paradigmas.ast.JavaCodeGenerator;
import una.paradigmas.node.Program;

import org.antlr.v4.runtime.CharStream;
import org.antlr.v4.runtime.CharStreams;
import org.antlr.v4.runtime.CommonTokenStream;

 /**
 * Proyecto: Expresso - Transpilador de lenguaje Expresso a Java
 * Curso: [EIF400-II-2025] Paradigmas de Programacion
 * Universidad Nacional de Costa Rica
 * 
 * Autores:
 * - Kendall Miso Chinchilla Araya  -   119310542
 * - Ignacio Serrano Gonzalez       -   402600631
 * - Minor Brenes Aguilar           -   116730106
 * - Pablo Chavarria Alvarez        -   117810573
 * 
 * Codigo de grupo: 02-1PM
 * 
 * This source file was generated by the Gradle 'init' task
 * 
 * Nota: Este codigo fue generado parcialmente con asistencia de IA
 * y posteriormente modificado, adaptado y validado por el equipo
 * de desarrollo para cumplir con los requerimientos especificos
 * del proyecto.
 */

 public class AppTest {
    
    private void testExpressoProgram(String input, String className) {
        CharStream charStream = CharStreams.fromString(input);
        ExpressoLexer lexer = new ExpressoLexer(charStream);
        CommonTokenStream tokens = new CommonTokenStream(lexer);
        ExpressoParser parser = new ExpressoParser(tokens);

        // Parsear y construir AST
        AstBuilder builder = new AstBuilder();
        Program ast = builder.visitProgram(parser.program());

        // Imprimir con print visitor
        // AstPrintVisitor printer = new AstPrintVisitor();
        // printer.visitProgram(ast);

        // Generar codigo Java a partir del AST
        JavaCodeGenerator generator = new JavaCodeGenerator(className);
        String javaCode = generator.generate(ast);
        System.out.println("\n");
        System.out.println(javaCode);
    }

    @Test 
    public void testHelloWorld0() {

        System.out.println("====== Test HelloWorld0.expresso ======");

        String input = """
            // HelloWorld0.expresso
            let x = 666
            print(x) // Expected 666 in console
            let y = 10
            print(y) // Expected 10 in console
            let f = z -> z 
            let f = z -> z ** 2 + 2*z + 1
            print(f(x) + f(y)) // expected 445010
        """;
        
        testExpressoProgram(input, "HelloWorld0");
    }

    @Test 
    public void testHelloWorld1() {

        System.out.println("====== Test HelloWorld1.expresso ======");

        String input = "// HelloWorld1.expresso\n\n" +
                      "/*\n" +
                      "  As HelloWorld0 but with a Binary Function\n" +
                      "  @author hooNous\n" +
                      "  @since Oct 6th, 2025\n" +
                      "*/\n\n" +
                      "let x = 6\n" +
                      "print(x)\n" +
                      "let y = 3\n" +
                      "print(y)\n" +
                      "let f:((int, int) -> int) = (w, z) -> z ** w + w*z + 1\n" +
                      "print(f(x, y)) // Expected 748\n";
        
        testExpressoProgram(input, "HelloWorld1");
    }

    @Test 
    public void testHelloWorld2() {

        System.out.println("====== Test HelloWorld2.expresso ======");

        String input = "// HelloWorld2.expresso\n\n" +
                      "/*\n" +
                      "  Boolean Logic\n" +
                      "  @author hooNous\n" +
                      "  @since Oct 6th, 2025\n" +
                      "*/\n\n" +
                      "let isZero :(int -> int) = x -> x ? 0 : 1\n" +
                      "let TRUE  = 1\n" +
                      "let FALSE = 0\n\n" +
                      "let isTrue :(int -> int) = x -> isZero(x) ? FALSE : TRUE\n\n" +
                      "let NOT :(int -> int) = x -> x ? 0 : 1\n\n" +
                      "let OR :((int, int) -> int) = (x, y) -> isTrue(x) ? TRUE : isTrue(y)\n\n" +
                      "let AND :((int, int) -> int) = (x, y) -> isTrue(x) ? isTrue(y) : FALSE\n\n" +
                      "let XOR :((int, int) -> int) = (x, y) -> AND(OR(x, y), NOT(AND(x, y)))\n\n" +
                      "print(XOR(TRUE, TRUE))   // Expected 0\n" +
                      "print(XOR(TRUE, FALSE))  // Expected 1\n" +
                      "print(XOR(FALSE, TRUE))  // Expected 1\n" +
                      "print(XOR(FALSE, FALSE)) // Expected 0\n";
        
        testExpressoProgram(input, "HelloWorld2");
    }

    // @Test 
    // public void testHelloWorld3() {

    //     System.out.println("====== Test HelloWorld3.expresso ======");
    //     System.out.println("====== Devil's surprises ======");

    //     String input = "/* HelloWorld3.expresso */\n" +
    //                     "\n" +
    //                     "/*\n" +
    //                     "  Devil's suprises\n" +
    //                     "  @author hooNous\n" +
    //                     "  @since Oct 6th, 2025\n" +
    //                     "*/\n" +
    //                     "\n" +
    //                     "/*\n" +
    //                     "Expected output:\n" +
    //                     "111\n" +
    //                     "1\n" +
    //                     "12\n" +
    //                     "222\n" +
    //                     "666\n" +
    //                     "12\n" +
    //                     "444\n" +
    //                     "0\n" +
    //                     "1\n" +
    //                     "555\n" +
    //                     "-666\n" +
    //                     "999\n" +
    //                     "*/\n" +
    //                     "\n" +
    //                     "/////////////////////////////////////////////////\n" +
    //                     "//# Section 111\n" +
    //                     "print(111)\n" +
    //                     "print(666 ? 1 : 2 + 10) // Expecting 1\n" +
    //                     "print(0 ? 1 : 2 + 10)   // Expecting 12\n" +
    //                     "\n" +
    //                     "/////////////////////////////////////////////////\n" +
    //                     "//# Section 222\n" +
    //                     "print(222)\n" +
    //                     "print( 0 ? 0 ? 1 : 2 + 10 : 666) // Expecting 666\n" +
    //                     "\n" +
    //                     "print( 1 ? 0 ? 1 : 2 + 10 : 666) // Expecting 12\n" +
    //                     "\n" +
    //                     "/////////////////////////////////////////////////\n" +
    //                     "//# Section 333\n" +
    //                     "/* ?: multiline */ \n" +
    //                     "let isZero = x -> x ? 0  : 1\n" +
    //                     "\n" +
    //                     "\n" +
    //                     "/* const */ let  TRUE  = /* */ 1\n" +
    //                     "/* const */ let  FALSE = 0\n" +
    //                     "\n" +
    //                     "/////////////////////////////////////////////////\n" +
    //                     "//# Section 444\n" +
    //                     "print(444)\n" +
    //                     "let mod_2 = x -> x - x / 2 * 2 \n" +
    //                     "\n" +
    //                     "print(mod_2(666))    // Expecting 0\n" +
    //                     "print(mod_2(666 +1)) // Expecting 1\n" +
    //                     "\n" +
    //                     "/////////////////////////////////////////////////\n" +
    //                     "//# Section 444\n" +
    //                     "print(555)\n" +
    //                     "\n" +
    //                     "let _hasUnderscores_ = -666 // must be parsed\n" +
    //                     "print(_hasUnderscores_)  // Expecting -666\n" + // falta resolver conflicto con PostOp
    //                     "\n" +
    //                     "/////////////////////////////////////////////////\n" +
    //                     "//# Section 999\n" +
    //                     "print(999)\n" +
    //                     "// print(variable_not_defined) // Expecting to be transpiled but not built";
        
    //     testExpressoProgram(input, "HelloWorld3");
    // }

    @Test 
    public void testHelloWorld4() {

        System.out.println("====== Test HelloWorld4.expresso ======");
        System.out.println("Tarea 13 - Tipos float-boolean-string-any");
                      
        String input = """
            let msg = "Hello \\"World\\""
            let x:float = 3.14
            let y = 666
            let b = true
            let s = "hello"
            print(x + 2.0 + y)
            print(s)
            print(b)
        """;
        
        testExpressoProgram(input, "HelloWorld4");
    }
    
    @Test 
    public void testHelloWorld5() {

        System.out.println("====== Test HelloWorld5.expresso ======");
        System.out.println("Tarea 14 - fun");
                      
        String input = """
            fun fact(n:int):int = n ? n * fact(n - 1) : 1
            """;
            
        testExpressoProgram(input, "HelloWorld5");
    }
    
    @Test 
    public void testHelloWorld6() {
    System.out.println("====== Test HelloWorld6.expresso ======");
    
    String input = "data nat = { Zero, S(n:nat) }\n" +
                   "data list = { Nil, Cons(car:any, cdr:list) }\n" +
                   "data gender = { Male, Female }\n" +
                   "let x = 666\n" +
                   "print(x)\n";
    
    testExpressoProgram(input, "HelloWorld6");
    }

    @Test
    public void testConstructorInvocation() {
        System.out.println("====== Test ConstructorInvocation.expresso ======");
        System.out.println("Tarea 17 - Soporte para el operador ^");

        String input = """
            data list = { Nil, Cons(car:any, cdr:list) }
            let x = ^Nil
            let y = ^Cons(666, ^Nil)
            print(y)
        """;

        testExpressoProgram(input, "ConstructorInvocation");
    }

    @Test
    public void testMatchWith() {
        System.out.println("====== Test MatchWith.expresso ======");
        System.out.println("Tarea 18 - match ... with");

        String input = """

            data nat = { 
                Zero, 
                S(nat) 
            } 

            fun sum(x:nat, y:nat):nat = match x with 
                                    Zero -> y 
                                    S(z) -> S(sum(z, y))
                                    _ -> x
        """;

        testExpressoProgram(input, "MatchWith");
    }

    // @Test
    // public void testMatchWithGuard() {
    //     System.out.println("====== Test MatchWithGuard.expresso ======");
    //     System.out.println("Tarea 18 - match ... with -> if");

    //     String input = """
    //         data nat = { 
    //             Zero, 
    //             S(nat) 
    //         } 

    //         fun isEven(x:nat):boolean = match x with
    //                                     Zero -> true
    //                                     S(Zero) -> false  
    //                                     S(S(z)) if z != Zero -> isEven(z)
    //                                     _ -> false

    //         fun sum(x:nat, y:nat):nat = match x with 
    //                                     Zero -> y 
    //                                     S(z) if z != Zero -> S(sum(z, y))
    //                                     S(z) -> x  // sin guard
    //                                     _ -> x
    //     """;

    //     testExpressoProgram(input, "MatchWithGuard");
    // }

    @Test
    public void testArrowTuple() {
        System.out.println("====== Test ArrowTuple.expresso ======");
        System.out.println("Tarea 18 - Arrow y Tuple");

        String input = """
            let lambdaArrow:((int, float, int) -> float) = (x, y, z) -> x + y + z
            let lambda:(int -> int) = x -> x + 1
            let lambdaCustom = (x, y, w) -> x
        """;

        testExpressoProgram(input, "ArrowTuple");
    }
     @Test
    public void testPrintAsNone() {
        System.out.println("====== Test printAsNone.expresso ======");
        System.out.println("Tarea 19 - print como expresion que retorna None");

        String input = """
            let x = none
            print(x)
            let y = print(42)
            print(y)
        """;
        testExpressoProgram(input, "HelloWorld7");
    }
    @Test
    public void testBooleanLogic() {
        System.out.println("====== Test BooleanLogic.expresso (Tarea 21) ======");

        String input = """
            // BooleanLogic.expresso
            // Prueba de operadores relacionales, booleanos y ternario
            // Cumple SPEC Final (7/10/2025) - Tarea 21
            
            let a = 5
            let b = 10
            let t = true
            let f = false
            
            // === Operadores relacionales ===
            print(a < b)      // true
            print(a > b)      // false
            print(a <= 5)     // true
            print(a >= 5)     // true
            print(a == 5)     // true
            print(a != 0)     // true
            
            // === Operadores booleanos ===
            print(t && a < 10)   // true
            print(f || b > 5)    // true
            print("-- !t: expected false --")
            print(!t)            // false
            print(t || f)        // true
            print(t && f)        // false
            
            // === Ternario con int (como en Mediano) ===
            print(a != 0 ? "ok" : "error")   // ok
            print(0 ? 1 : 0)                 // 0
            
            // === Ternario con boolean (nuevo en Final) ===
            print(t ? "yes" : "no")          // yes
            print(f ? "yes" : "no")          // no
            
            // === Combinaci√≥n compleja ===
            print(a < b && t || a == 0)      // true
            print(!f && b >= 10)             // true
            print(a <= 5 ? b * 2 : b / 2)    // 20
            """;

        testExpressoProgram(input, "BooleanLogic");
    }
}